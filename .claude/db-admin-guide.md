# データベース管理ページ解説

## 概要
`db-admin.php` は会議室予約システムのデータベースを管理するためのWebページです。

## アクセス方法
ブラウザで以下のURLにアクセスしてください：
```
http://localhost/meeting-room-reservation-09/db-admin.php
```

## 機能一覧

### 1. データベース状態確認
- データベースファイルの存在確認
- 各テーブルのレコード数表示
- テーブル一覧表示

### 2. データベース初期化
- テーブルの作成
- 初期部署データの投入
- 管理者ユーザーの作成
- **実行前確認:** 既存データは失われます

### 3. CSVインポート
以下の3つのCSVファイルからデータを一括インポートできます：

#### departments.csv（部署データ）
```csv
id,name,default_color,display_order
1,総務部,#FF6B6B,1
2,営業部,#4ECDC4,2
```

#### users.csv（ユーザーデータ）
```csv
id,name,email,password,admin,department_id,email_notification
1,管理者,admin@company.com,admin123,1,1,0
2,田中太郎,tanaka@company.com,password123,0,2,1
```

#### reservations.csv（予約データ）
```csv
id,user_id,title,description,date,start_datetime,end_datetime,is_company_wide
1,2,週次定例会議,営業部の週次会議,2024-07-15,2024-07-15T10:00:00,2024-07-15T11:00:00,0
```

### 4. データベース削除
- データベースファイルの完全削除
- **注意:** この操作は元に戻すことができません

## サンプルデータ
`sample-data/` フォルダにサンプルCSVファイルが用意されています：
- `departments.csv` - 7つの部署データ
- `users.csv` - 10名のユーザーデータ
- `reservations.csv` - 10件の予約データ

## セキュリティ
- SQLインジェクション対策
- ファイルアップロード時の検証

## 使用方法の例

### 1. 初回セットアップ
1. `db-admin.php` にアクセス
2. 「データベース初期化」を実行
3. 管理者ユーザーが作成されます（admin@company.com / admin123）

### 2. サンプルデータの投入
1. `sample-data/` フォルダからCSVファイルを選択
2. 「CSVインポート実行」を実行
3. データベース状態でレコード数を確認

### 3. データベースのリセット
1. 「データベース削除」を実行
2. 「データベース初期化」を実行
3. 必要に応じてCSVデータをインポート

## トラブルシューティング

### エラー: "CSVファイルを開けませんでした"
- ファイル形式がCSVであることを確認
- ファイルが破損していないか確認
- 文字コードがUTF-8であることを確認

### エラー: "データベース接続エラー"
- データベースファイルのパーミッションを確認
- PHPのSQLite拡張が有効であることを確認

## 技術仕様
- PHP 7.4以上
- SQLite3
- PDO拡張

## 注意事項
- 本番環境では適切なバックアップを取ってから操作してください
- CSVファイルの文字コードはUTF-8を推奨します
- 大量データのインポート時はPHPの実行時間制限にご注意ください