# ログイン・ログアウト機能 解説

## 概要
会議室予約システムにログイン・ログアウト機能を実装しました。セッション管理によるユーザー認証機能を提供します。

## 実装されたファイル

### JavaScriptファイル
- **common.js**: 共通関数とイベントリスナー管理
- **index.js**: メインページ（index.html）用スクリプト
- **department.js**: 部署管理ページ（department.html）用スクリプト
- **config.js**: 設定ページ（config.html）用スクリプト

### PHPファイル（API）
- **database.php**: データベース接続とユーティリティ関数
- **session.php**: セッション情報の管理
- **login.php**: ログイン処理
- **logout.php**: ログアウト処理

## 主な機能

### 1. 共通処理（common.js）
- ログイン状態の確認
- 管理者権限の確認
- ヘッダーの動的表示
- ログイン/ログアウトフォームの処理

### 2. セッション管理
- PHPセッションを使用したユーザー認証
- ログイン状態の永続化
- セッション情報の取得API

### 3. ログイン機能
- メールアドレスとパスワードによる認証
- パスワードのハッシュ化による安全な認証
- 部署情報の自動取得

### 4. ログアウト機能
- セッションの破棄
- ログアウト後の状態更新

## 各ページの動作

### index.html（メインページ）
- ログイン状態に応じたUI表示
- 予約操作ボタンの表示/非表示制御
- 予約一覧の表示

### department.html（部署管理）
- 管理者権限チェック
- 部署のCRUD操作
- 部署一覧の表示

### config.html（設定ページ）
- ログイン必須チェック
- ユーザー設定の表示・更新
- パスワード変更機能

## ヘッダー機能

### ログイン前
- システムタイトル表示
- ログインフォーム（メールアドレス、パスワード）
- ログインボタン

### ログイン後
- ユーザー情報表示（名前、部署、管理者フラグ）
- ナビゲーションメニュー
  - 予約管理
  - 設定
  - 部署管理（管理者のみ）
- ログアウトボタン

## セキュリティ機能

### 1. パスワードハッシュ化
- password_hash()によるパスワードのハッシュ化
- password_verify()による安全な認証

### 2. 入力値のサニタイズ
- HTMLspecialchars()による入力値のエスケープ
- メールアドレスのバリデーション

### 3. セッション管理
- セッションIDの自動生成
- ログアウト時のセッション破棄

## API仕様

### セッション確認
- **URL**: /api/session.php
- **メソッド**: GET
- **レスポンス**: ログイン状態とユーザー情報

### ログイン
- **URL**: /api/login.php
- **メソッド**: POST
- **パラメータ**: email, password
- **レスポンス**: ログイン結果とユーザー情報

### ログアウト
- **URL**: /api/logout.php
- **メソッド**: POST
- **レスポンス**: ログアウト結果

## 使用方法

### 1. 初期設定
1. DB初期化: http://localhost/meeting-room-reservation-08/init_db.php
2. 各HTMLファイルにJavaScriptのimport文を追加

### 2. 各ページの利用
- **メインページ**: http://localhost/meeting-room-reservation-08/index.html
- **設定ページ**: http://localhost/meeting-room-reservation-08/config.html
- **部署管理**: http://localhost/meeting-room-reservation-08/department.html

### 3. ログイン
1. ページ右上のログインフォームにメールアドレスとパスワードを入力
2. ログインボタンをクリック
3. ログイン成功後、ヘッダーにユーザー情報が表示される

### 4. ログアウト
1. ヘッダーのログアウトボタンをクリック
2. ログアウト後、ログインフォームに戻る

## 注意事項

### 1. HTMLファイルへの統合
各HTMLファイルに以下のscriptタグを追加する必要があります：
```html
<script type="module" src="src/js/common.js"></script>
<script type="module" src="src/js/[対応するページ].js"></script>
```

### 2. CSSスタイル
ヘッダーやフォームのスタイルを適切に設定してください。

### 3. データベース初期データ
テスト用のユーザーデータを事前に登録してください。

### 4. エラーハンドリング
JavaScriptのconsole.errorとPHPのerror_logでエラーログを記録しています。

## 今後の拡張予定
- 予約関連のCRUD API実装
- 部署管理API実装
- ユーザー設定API実装
- メール通知機能実装